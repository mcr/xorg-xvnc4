#! /bin/sh /usr/share/dpatch/dpatch-run
## 001-CVE-2006-1526.dpatch by  <fabbione@gordian.int.fabbione.net>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad xorg-server-1.0.2~/render/mitri.c xorg-server-1.0.2/render/mitri.c
--- xorg-server-1.0.2~/render/mitri.c	2006-05-03 09:28:50.000000000 +0200
+++ xorg-server-1.0.2/render/mitri.c	2006-05-03 09:55:04.000000000 +0200
@@ -145,7 +145,9 @@
     if (npoint < 3)
 	return;
     ntri = npoint - 2;
-    tris = ALLOCATE_LOCAL (ntri & sizeof (xTriangle));
+    if (ntri >= INT_MAX/sizeof (xTriangle))
+	return;
+    tris = ALLOCATE_LOCAL (ntri * sizeof (xTriangle));
     if (!tris)
 	return;
     for (tri = tris; npoint >= 3; npoint--, points++, tri++)
@@ -173,11 +175,12 @@
     xTriangle		*tris, *tri;
     xPointFixed		*first;
     int			ntri;
-    
     if (npoint < 3)
 	return;
     ntri = npoint - 2;
-    tris = ALLOCATE_LOCAL (ntri & sizeof (xTriangle));
+    if (ntri >= INT_MAX/sizeof (xTriangle))
+	return;
+    tris = ALLOCATE_LOCAL (ntri * sizeof (xTriangle));
     if (!tris)
 	return;
     first = points++;
